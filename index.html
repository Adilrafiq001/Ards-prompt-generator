<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARD's Prompt Generator</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2563eb"/>

  <!-- React + Babel + Tailwind -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full bg-gray-50 text-gray-900">
  <div id="root" class="h-full"></div>

  <!-- Register service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>

  <!-- App -->
  <script type="text/babel">
    function App() {
      const [prompts, setPrompts] = React.useState(() => {
        try { return JSON.parse(localStorage.getItem("ards_prompts")) || []; }
        catch { return []; }
      });
      const [input, setInput] = React.useState("");
      const [selected, setSelected] = React.useState(null);

      React.useEffect(() => {
        localStorage.setItem("ards_prompts", JSON.stringify(prompts));
      }, [prompts]);

      function scorePrompt(text) {
        if (!text) return 0;
        let score = 0;
        if (text.length > 20) score += 20;
        if (/\bplease|explain|generate|list|design|summarize\b/i.test(text)) score += 20;
        if (/[?.!]/.test(text)) score += 10;
        if (text.includes("you are")) score += 20;
        if (text.split(" ").length > 8) score += 20;
        if (/output|format|table|json/i.test(text)) score += 10;
        return Math.min(score, 100);
      }

      function enhancePrompt(text) {
        let out = text;
        if (!/you are/i.test(out)) out = "You are an expert assistant. " + out;
        if (!/output|format/i.test(out)) out += " Provide output in a clear format.";
        return out;
      }

      function addPrompt() {
        if (!input.trim()) return;
        const newPrompt = { id: Date.now(), text: input.trim(), rating: scorePrompt(input.trim()), favorite: false };
        setPrompts([newPrompt, ...prompts]);
        setInput("");
      }

      function toggleFavorite(id) {
        setPrompts(prompts.map(p => p.id === id ? { ...p, favorite: !p.favorite } : p));
      }

      function deletePrompt(id) {
        if (confirm("Delete this prompt?")) {
          setPrompts(prompts.filter(p => p.id !== id));
        }
      }

      return (
        <div className="max-w-xl mx-auto p-4 space-y-4">
          <h1 className="text-2xl font-bold text-center text-blue-600">ARD's Prompt Generator</h1>

          <div className="bg-white p-4 rounded-xl shadow space-y-3">
            <textarea
              value={input}
              onChange={e => setInput(e.target.value)}
              rows={3}
              placeholder="Type your prompt here..."
              className="w-full p-3 border rounded-lg focus:ring outline-none"
            />
            <button onClick={addPrompt}
              className="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 w-full">
              Add Prompt
            </button>
          </div>

          <div className="space-y-3">
            {prompts.map(p => (
              <div key={p.id} className="bg-white p-3 rounded-lg shadow flex flex-col gap-2">
                <div className="flex justify-between items-center">
                  <span className="font-medium">Score: {p.rating}</span>
                  <div className="flex gap-2">
                    <button onClick={() => toggleFavorite(p.id)} className="text-yellow-500">
                      {p.favorite ? "★" : "☆"}
                    </button>
                    <button onClick={() => setSelected(p)} className="text-blue-500">Edit</button>
                    <button onClick={() => deletePrompt(p.id)} className="text-red-500">Delete</button>
                  </div>
                </div>
                <div className="text-gray-700 whitespace-pre-wrap">{p.text}</div>
              </div>
            ))}
          </div>

          {selected && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center">
              <div className="bg-white p-4 rounded-xl max-w-md w-full space-y-3">
                <h2 className="text-lg font-semibold">Edit Prompt</h2>
                <textarea
                  value={selected.text}
                  onChange={e => setSelected({ ...selected, text: e.target.value })}
                  rows={3}
                  className="w-full p-2 border rounded-lg"
                />
                <button onClick={() => {
                  setPrompts(prompts.map(p =>
                    p.id === selected.id
                      ? { ...p, text: selected.text, rating: scorePrompt(selected.text) }
                      : p
                  ));
                  setSelected(null);
                }} className="px-4 py-2 bg-blue-600 text-white rounded-lg w-full">Save</button>
                <button onClick={() => setSelected(null)} className="px-4 py-2 bg-gray-200 rounded-lg w-full">Cancel</button>
                <div className="bg-gray-50 p-2 rounded text-sm text-gray-600">Enhanced: {enhancePrompt(selected.text)}</div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
